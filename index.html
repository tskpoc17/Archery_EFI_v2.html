<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EFI å°„ç®­é›™è»¸è¨ºæ–·ç³»çµ±</title>
    <style>
        :root { --primary: #007bff; --success: #28a745; --warning: #ffc107; --danger: #dc3545; --bg: #f8f9fa; }
        body { font-family: -apple-system, "Segoe UI", Roboto, sans-serif; background-color: var(--bg); padding: 15px; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 500px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); padding: 25px; }
        .header { text-align: center; margin-bottom: 25px; }
        .header h1 { font-size: 24px; color: #333; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .section-box { background: #e7f3ff; border-radius: 12px; padding: 15px; margin-bottom: 20px; border-left: 5px solid var(--primary); }
        .section-title { font-weight: bold; color: var(--primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        input { flex: 1; padding: 12px; border: 1px solid #dee2e6; border-radius: 10px; font-size: 16px; }
        .hint { font-size: 12px; color: #6c757d; margin-top: -5px; margin-bottom: 10px; }
        button { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s; }
        .btn-diag { background: var(--primary); color: white; margin-bottom: 20px; }
        .btn-diag:active { transform: scale(0.98); }
        .result-card { background: #fff; border-radius: 15px; padding: 15px; border: 1px solid #eef2f7; margin-bottom: 15px; }
        .analysis-box { background: #fff4e6; border-radius: 12px; padding: 15px; border: 1px solid #ffe8cc; font-size: 14px; line-height: 1.6; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ğŸ¯ EFI å°„ç®­é›™è»¸è¨ºæ–·ç³»çµ±</h1>
    </div>

    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
        <select id="targetType" style="flex: 1.5; padding: 10px; border-radius: 10px; border: 1px solid #ddd;">
            <option>80cm (30/50å…¬å°º)</option>
            <option>122cm (70/90å…¬å°º)</option>
        </select>
        <input type="number" id="kValue" value="1" placeholder="Kå€¼" style="flex: 0.5;">
    </div>

    <div class="section-box">
        <div class="section-title">âš–ï¸ X è»¸æ°´å¹³åº§æ¨™åˆ†å€¼</div>
        <div class="input-row">
            <input type="number" id="pxE" placeholder="å³å·¦å·®å¹³å‡" step="0.1">
            <input type="number" id="pxM" placeholder="é›¢å·®å¹³å‡" step="0.1">
        </div>
        <input type="number" id="inX" placeholder="è¼¸å…¥æ¨£æœ¬æ”¯æ•¸ (N)" style="margin-bottom: 5px;">
        <div class="hint">å³å´ç‚ºæ­£ (+)ï¼Œå·¦å´ç‚ºè²  (-)</div>
    </div>

    <div class="section-box" style="background: #f0f7ff; border-left-color: #28a745;">
        <div class="section-title" style="color: #28a745;">â†•ï¸ Y è»¸å‚ç›´åº§æ¨™åˆ†å€¼</div>
        <div class="input-row">
            <input type="number" id="pyE" placeholder="ä¸Šä¸‹å·®å¹³å‡" step="0.1">
            <input type="number" id="pyM" placeholder="é›¢å·®å¹³å‡" step="0.1">
        </div>
        <input type="number" id="inY" placeholder="è¼¸å…¥æ¨£æœ¬æ”¯æ•¸ (N)" style="margin-bottom: 5px;">
        <div class="hint">ä¸Šæ–¹ç‚ºæ­£ (+)ï¼Œä¸‹æ–¹ç‚ºè²  (-)</div>
    </div>

    <button class="btn-diag" onclick="runDiag()">åŸ·è¡Œé›™è»¸æ•¸æ“šè¨ºæ–·</button>

    <div class="analysis-box">
        <strong>ğŸ’¡ ç¶œåˆåˆ†æå»ºè­°</strong><br>
        <div id="summaryText">è«‹è¼¸å…¥æ•¸æ“šä¸¦é»æ“Šè¨ºæ–·ã€‚</div>
        <div id="diagTime" style="font-size: 12px; color: #888; margin-top: 10px; display: flex; align-items: center; gap: 5px;"></div>
    </div>
    
    <div class="result-card" id="resX" style="margin-top: 15px; display: none;">
        <div style="font-size: 14px; color: #666;">ğŸ“ˆ X è»¸åˆ†æå ±å‘Š</div>
        <div id="resultX" style="font-size: 20px; font-weight: bold; color: var(--primary); margin: 5px 0;"></div>
    </div>
    
    <div class="result-card" id="resY" style="display: none;">
        <div style="font-size: 14px; color: #666;">ğŸ“ˆ Y è»¸åˆ†æå ±å‘Š</div>
        <div id="resultY" style="font-size: 20px; font-weight: bold; color: var(--success); margin: 5px 0;"></div>
    </div>

</div>

<script>
(function() {
    const STORAGE_KEY = 'archery_data_v2';

    // 1. å»ºç«‹å„²å­˜ UI æ’ä»¶
    window.addEventListener('load', function() {
        const diagBtn = document.querySelector('.btn-diag');
        const saveUI = document.createElement('div');
        saveUI.style = "margin-top: -10px; margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px;";
        saveUI.innerHTML = `
            <button id="p_save" style="background: var(--success); color: white;">ğŸ•’ å„²å­˜ç•¶å‰æ•¸æ“šèˆ‡æ™‚é–“</button>
            <div style="display: flex; gap: 5px;">
                <select id="p_list" style="flex: 1; border-radius: 10px; border: 1px solid #ddd;"></select>
                <button id="p_load" style="flex: 0.6; background: #6f42c1; color: white; padding: 10px;">è¼‰å…¥</button>
                <button id="p_del" style="flex: 0.4; background: var(--danger); color: white; padding: 10px;">åˆªé™¤</button>
            </div>
        `;
        diagBtn.parentNode.insertBefore(saveUI, diagBtn.nextSibling);

        const list = document.getElementById('p_list');
        const refresh = () => {
            const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            list.innerHTML = '<option value="">-- æ­·å²ç´€éŒ„ --</option>';
            Object.keys(history).sort().reverse().forEach(t => {
                const opt = document.createElement('option');
                opt.value = t; opt.innerText = t; list.appendChild(opt);
            });
        };

        document.getElementById('p_save').onclick = () => {
            const now = new Date();
            const time = `${now.getFullYear()}/${now.getMonth()+1}/${now.getDate()} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
            const data = { pxE: document.getElementById('pxE').value, pxM: document.getElementById('pxM').value, inX: document.getElementById('inX').value, pyE: document.getElementById('pyE').value, pyM: document.getElementById('pyM').value, inY: document.getElementById('inY').value, k: document.getElementById('kValue').value };
            const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            history[time] = data;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
            refresh(); alert('æ•¸æ“šå·²å­˜æ–¼ ' + time);
        };

        document.getElementById('p_load').onclick = () => {
            const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            const d = history[list.value];
            if (d) {
                document.getElementById('pxE').value = d.pxE; document.getElementById('pxM').value = d.pxM; document.getElementById('inX').value = d.inX;
                document.getElementById('pyE').value = d.pyE; document.getElementById('pyM').value = d.pyM; document.getElementById('inY').value = d.inY;
                document.getElementById('kValue').value = d.k;
            }
        };

        document.getElementById('p_del').onclick = () => {
            const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            delete history[list.value];
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
            refresh();
        };

        refresh();

        // 2. ç½®æ›æ ¸å¿ƒå…¬å¼ï¼š11 - K * (Gap + MAD)
        window.runDiag = function() {
            const pxE = parseFloat(document.getElementById('pxE').value) || 0;
            const pxM = parseFloat(document.getElementById('pxM').value) || 0;
            const pyE = parseFloat(document.getElementById('pyE').value) || 0;
            const pyM = parseFloat(document.getElementById('pyM').value) || 0;
            const k = parseFloat(document.getElementById('kValue').value) || 1;

            const efiX = 11 - k * (Math.abs(pxE) + pxM);
            const efiY = 11 - k * (Math.abs(pyE) + pyM);

            document.getElementById('resX').style.display = 'block';
            document.getElementById('resY').style.display = 'block';
            document.getElementById('resultX').innerText = `EFI: ${efiX.toFixed(4)}`;
            document.getElementById('resultY').innerText = `EFI: ${efiY.toFixed(4)}`;

            const now = new Date();
            document.getElementById('diagTime').innerHTML = `ğŸ•’ è¨ºæ–·æ™‚é–“ï¼š${now.getFullYear()}/${now.getMonth()+1}/${now.getDate()} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
            
            let advice = "åˆ†æå»ºè­°ï¼š\n";
            if (efiX < 7 || efiY < 7) advice += "âš ï¸ é›¢æ•£é¢¨éšªè¼ƒé«˜ï¼Œå»ºè­°æª¢æŸ¥ç™¼åŠ›ç©©å®šæ€§ã€‚";
            else advice += "âœ… å‹•ä½œä¸€è‡´æ€§è‰¯å¥½ï¼Œè«‹ç¶­æŒç¯€å¥ã€‚";
            document.getElementById('summaryText').innerText = advice;
        };
    });
})();
</script>

</body>
</html>
